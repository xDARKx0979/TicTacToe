<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Run 3</title>
	<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-MENBM6GSNY"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MENBM6GSNY")</script>
	<script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako_inflate.min.js"></script>
	<script>
		// Helper function to load and decompress gzipped files
		window.loadGzippedResource = function(url, type, callback) {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', url, true);
			xhr.responseType = 'arraybuffer';
			xhr.onload = function() {
				if (xhr.status === 200) {
					try {
						var decompressed = pako.inflate(new Uint8Array(xhr.response));
						if (type === 'text') {
							callback(new TextDecoder().decode(decompressed));
						} else {
							callback(decompressed.buffer);
						}
					} catch (e) {
						console.error('Error decompressing resource:', url, e);
						callback(null);
					}
				} else {
					callback(null);
				}
			};
			xhr.send();
		};

		// Handle regular Audio element creation to intercept compressed ogg files
		var originalAudio = window.Audio;
		window.Audio = function() {
			var audio = new originalAudio();
			var originalSrcSetter = Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, 'src').set;
			
			Object.defineProperty(audio, 'src', {
				set: function(url) {
					if (url && url.endsWith('.ogg.gz')) {
						// For compressed ogg files, create a blob URL
						var gzUrl = url;
						window.loadGzippedResource(gzUrl, 'binary', function(buffer) {
							if (buffer) {
								var blob = new Blob([buffer], { type: 'audio/ogg' });
								var blobUrl = URL.createObjectURL(blob);
								originalSrcSetter.call(audio, blobUrl);
							}
						});
					} else {
						originalSrcSetter.call(audio, url);
					}
				},
				get: function() {
					return audio.currentSrc;
				}
			});
			
			return audio;
		};

		// Load and decompress the Run3.js file
		(function() {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', './Run3.js', true);
			xhr.responseType = 'arraybuffer';
			xhr.onload = function() {
				if (xhr.status === 200) {
					try {
						// Try to decompress using pako (gzip library)
						var decompressed = pako.inflate(new Uint8Array(xhr.response), { to: 'string' });
						
						// Execute the decompressed code
						var script = document.createElement('script');
						script.textContent = decompressed;
						document.head.appendChild(script);
					} catch (e) {
						console.error('Error decompressing Run3.js:', e);
					}
				}
			};
			xhr.send();
		})();
	</script>
	<script>
		window.addEventListener ("touchmove", function (event) { event.preventDefault (); }, { capture: false, passive: false });
		if (typeof window.devicePixelRatio !='undefined' && window.devicePixelRatio > 2) {
			var meta = document.getElementById ("viewport");
			meta.setAttribute ('content', 'width=device-width, initial-scale=' + (2 / window.devicePixelRatio) + ', user-scalable=no');
		}
	</script>
	<style>
		html,body { margin: 0; padding: 0; height: 100%; overflow: hidden; }
		#openfl-content { background: #000000; width: 100%; height: 100%; }
		@font-face {
			font-family: 'Comfortaa Bold';
			src: url('font/COMFORTAA-BOLD.woff') format('woff');
			font-weight: normal;
			font-style: normal;
		}
		@font-face {
			font-family: 'Comfortaa';
			src: url('font/Comfortaa.woff') format('woff');
			font-weight: normal;
			font-style: normal;
		}
		@font-face {
			font-family: 'Permanent Marker';
			src: url('font/PERMANENTMARKER.woff') format('woff');
			font-weight: normal;
			font-style: normal;
		}
	</style>
	
</head>
<body>
	
	<noscript>This webpage makes extensive use of JavaScript. Please enable JavaScript in your web browser to view this page.</noscript>
	
	<div id="openfl-content"></div>
	
	<script type="text/javascript">
		window.addEventListener('load', function() {
			setTimeout(function() {
				// Make sure lime is loaded (from the decompressed script)
				if (typeof lime !== 'undefined') {
					// Patch openfl/lime to handle compressed resources
					if (lime.net && lime.net.URLLoader) {
						var originalLoad = lime.net.URLLoader.prototype.load;
						lime.net.URLLoader.prototype.load = function(request) {
							var urlLoader = this;
							var url = request.url;
							
							if (url && (url.endsWith('.ogg.gz') || url.endsWith('.sfd.gz'))) {
								window.loadGzippedResource(url, 'binary', function(buffer) {
									if (buffer) {
										urlLoader.__data = buffer;
										if (urlLoader.onComplete) urlLoader.onComplete();
									}
								});
								return;
							}
							
							return originalLoad.call(this, request);
						};
					}
					
					lime.embed("Run3", "openfl-content", 800, 600, { parameters: {} });
				} else {
					console.error('Run3.js failed to load properly');
				}
			}, 1000); // Short delay to ensure script execution completes
		});
	</script>
	<script src="https://cdn.jsdelivr.net/gh/st39/sdk@main/api.js"></script>
</body>
</html>
